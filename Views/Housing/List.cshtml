@model IEnumerable<Booking.web.Models.HousingViewModel>

<style>
    .search-container {
        display: flex;
        gap: 20px;
        max-width: 1100px;
        margin: 20px auto;
        padding: 0 15px;
        color: #333;
    }

    .results-list {
        flex: 1;
        padding: 0;
        margin: 0;
    }

    .cards-container {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .hotel-card-mini {
        width: 100%;
        height: 180px;
        background: #003580;
        border-radius: 12px;
        display: flex;
        overflow: hidden;
        color: #fff;
        font-family: 'Segoe UI', Arial, sans-serif;
        box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        transition: transform 0.2s;
    }

        .hotel-card-mini:hover {
            transform: scale(1.01);
        }

    .image-wrapper {
        flex: 0 0 220px;
        height: 100%;
    }

        .image-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

    .content-mini {
        flex: 1;
        padding: 16px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        min-width: 0;
    }

    .info-top h2 {
        font-size: 1.1rem;
        margin: 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .stars-display {
        background: #febb02;
        color: #003580;
        padding: 2px 8px;
        border-radius: 4px;
        font-weight: bold;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .loc-mini {
        font-size: 0.85rem;
        opacity: 0.85;
        margin: 4px 0;
    }

    .footer-mini {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
    }

    .price-box {
        display: flex;
        flex-direction: column;
    }

    .new-p {
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1;
    }

    .btn-mini {
        background: #006ce4;
        color: white;
        padding: 9px 18px;
        border-radius: 6px;
        font-weight: bold;
        text-decoration: none;
        transition: background 0.2s;
    }

        .btn-mini:hover {
            background: #0053b3;
            color: white;
        }

    .italic {
        font-style: italic;
    }
</style>

<div class="search-container">
    <aside class="filters-sidebar" style="flex: 0 0 250px;">
        <div class="filter-section p-3 border rounded bg-light shadow-sm">
            <h5 class="fw-bold mb-3 text-dark">@Localizer["Filters"]</h5>

            <div class="filter-group mb-3">
                <label class="small fw-bold text-muted">Cidade</label>
                @Html.DropDownList("cityId", (SelectList)ViewBag.Cities, "Todas", new { @class = "form-select form-select-sm", id = "cityId" })
            </div>

            <div class="filter-group mb-3">
                <label class="small fw-bold text-muted">Preço Máximo</label>
                <div class="input-group input-group-sm">
                    <span class="input-group-text">€</span>
                    <input type="number" id="maxPrice" class="form-control" placeholder="Ex: 100">
                </div>
            </div>

            <button id="applyFilters" class="btn btn-primary btn-sm w-100 fw-bold shadow-sm">
                <i class="bi bi-search me-1"></i> Aplicar
            </button>

            <button onclick="location.reload()" class="btn btn-outline-secondary btn-sm w-100 mt-2 small">
                Limpar
            </button>
        </div>
    </aside>

    <div class="results-list">
        <div class="cards-container" id="cardsContainer">
            @await Html.PartialAsync("_HousingCards", Model)
        </div>
    </div>
</div>

<script>
    document.getElementById("applyFilters")?.addEventListener("click", function () {
        const max = document.getElementById("maxPrice").value;
        const city = document.getElementById("cityId").value;

        // criar parametros  
        const params = new URLSearchParams();
        if (max) params.append("maxPrice", max);
        if (city) params.append("cityId", city);

        //  visual 
        const container = document.getElementById("cardsContainer");
        container.style.opacity = "0.5";

        fetch('/Housing/List?' + params.toString(), {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(res => {
            if (!res.ok) throw new Error("Erro na resposta");
            return res.text();
        })
        .then(html => {
            container.innerHTML = html;
            container.style.opacity = "1";
        })
        .catch(err => {
            console.error("Erro ao filtrar:", err);
            container.style.opacity = "1";
        });
    });

    function alterarComissao(id, taxaAtual) {
        const novaTaxa = prompt("Nova taxa de comissão (%):", taxaAtual);
        if (novaTaxa !== null && !isNaN(novaTaxa)) {
            fetch("/Admin/UpdateCommission?id=" + id + "&newRate=" + novaTaxa.replace(',', '.'), { method: 'POST' })
            .then(res => res.ok ? location.reload() : alert("Erro ao atualizar."));
        }
    }
</script>